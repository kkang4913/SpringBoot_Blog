<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cos.blog.repository.UserRepository">

    <select id="findById" resultType="com.cos.blog.model.User">
        SELECT *
            FROM
                "USER"
            WHERE
                ID = #{id}
    </select>

    <select id="findAll" resultType="com.cos.blog.model.User">
        SELECT *
            FROM
                "USER"
    </select>

    <!-- 사용자 목록을 페이징하여 가져오는 쿼리 -->
    <select id="selectUserPage" resultType="com.cos.blog.model.User">
        <![CDATA[
    SELECT *
            FROM (
                SELECT /*+ FIRST_ROWS(n) */
                    U.*,
                    ROWNUM AS rnum
                FROM (
                    SELECT *
                    FROM "USER"
                    ORDER BY id DESC
                ) U
                WHERE ROWNUM <= #{end}
            )
            WHERE rnum > #{start}
    ]]>
</select>

    <insert id="save" parameterType="com.cos.blog.model.User">
        INSERT INTO
            "USER" (
                    ID
                   ,USERNAME
                   ,PASSWORD
                   ,EMAIL
                   ,CREATEDATE)
        VALUES (
                USER_SEQ.NEXTVAL
               ,#{username}
               ,#{password}
               ,#{email}
               ,CURRENT_DATE
               )
    </insert>

    <update id="update" parameterType="com.cos.blog.model.User">
        UPDATE "USER"
            <set>
                <if test="password != null">PASSWORD = #{password},</if>
                <if test="email != null">EMAIL = #{email},</if>
            </set>
        WHERE ID = #{id}

    </update>

    <delete id="deleteById" parameterType="int">
        DELETE
            FROM "USER"
        WHERE ID = #{id}
    </delete>

<!--    <select id="finByUsernameAndPassword" parameterType="com.cos.blog.model.User">-->
<!--        SELECT *-->
<!--            FROM-->
<!--                "USER"-->
<!--            WHERE-->
<!--                username = #{username}-->
<!--            AND-->
<!--                password = #{password}-->

<!--    </select>-->
    <select id="findByUsername" parameterType="com.cos.blog.model.User">
        SELECT *
        FROM
            "USER"
        WHERE
            username = #{username}
    </select>


</mapper>